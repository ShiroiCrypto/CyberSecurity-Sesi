<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>SECTEAM | O C√≥digo do Invasor</title>
  <link rel="stylesheet" href="game.css">
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <canvas id="matrix"></canvas>
  <main class="container">
    <div class="header-scanline"></div>
    <h1>üïµÔ∏è O C√ìDIGO DO INVASOR</h1>

    <section class="scenario">
      <p class="story">
        <strong>ALERTA DE INTRUS√ÉO:</strong> Um hacker bloqueou os servidores do SESI. 
        Para liberar o acesso, decifre a mensagem abaixo antes que o tempo expire.
      </p>
    </section>

    <section class="puzzle">
      <label class="label">ENIGMA 01 ‚Äî Protocolo de Criptografia</label>
      <div class="cipher" id="cipherText">"VHQKD VHJXUD"</div>
      
      <div class="hint-row">
        <button id="hintBtn" class="btn">SOLICITAR DICA</button>
        <button id="startBtn" class="btn primary">INICIAR CONTAGEM</button>
      </div>

      <div class="timer" id="timer">05:00</div>

      <div class="input-row">
        <input type="text" id="answerInput" placeholder="Digite a mensagem decifrada..." autocomplete="off">
        <button id="submitBtn" class="btn success">ENVIAR</button>
      </div>
      <p id="feedback" class="feedback"></p>
    </section>
  </main>

  <script>
    const timerEl = document.getElementById('timer');
    const startBtn = document.getElementById('startBtn');
    const hintBtn = document.getElementById('hintBtn');
    const submitBtn = document.getElementById('submitBtn');
    const answerInput = document.getElementById('answerInput');
    const feedback = document.getElementById('feedback');

    let timeLeft = 300; // 5 minutos
    let timer = null;
    let started = false;

    function formatTime(s) {
      const min = Math.floor(s / 60);
      const sec = s % 60;
      return `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
    }

    function tick() {
      if (timeLeft <= 0) {
        clearInterval(timer);
        feedback.className = 'feedback fail';
        feedback.textContent = 'SISTEMA FORMATADO. ACESSO NEGADO.';
        return;
      }
      timeLeft--;
      timerEl.textContent = formatTime(timeLeft);
    }

    function resetTimer() {
      clearInterval(timer);
      timeLeft = 300;
      timerEl.textContent = formatTime(timeLeft);
      started = false;
      startBtn.disabled = false;
      startBtn.textContent = 'REINICIAR CONTAGEM';
    }

    startBtn.addEventListener('click', () => {
      if (started) return;
      started = true;
      timer = setInterval(tick, 1000);
      startBtn.disabled = true;
      startBtn.textContent = 'OPERACIONAL...';
    });

    hintBtn.addEventListener('click', () => {
      alert("DICA DO SISTEMA: O hacker usou a Cifra de C√©sar. Volte 3 casas no alfabeto (Ex: D vira A).");
    });

    function normalizeText(t) {
      return t.toUpperCase().replace(/[^A-Z0-9]/g, '').trim();
    }

    submitBtn.addEventListener('click', () => {
      if (!started) {
        feedback.className = 'feedback warn';
        feedback.textContent = 'Inicie o cron√¥metro primeiro!';
        return;
      }

      const val = normalizeText(answerInput.value);
      // A resposta correta √© SENHA SEGURA
      if (val === "SENHASEGURA") {
        clearInterval(timer);
        feedback.className = 'feedback success-msg';
        feedback.textContent = 'ACESSO CONCEDIDO! Sistema Seguro.';
        document.body.style.boxShadow = "inset 0 0 100px rgba(0, 242, 255, 0.2)";
      } else {
        feedback.className = 'feedback fail';
        feedback.textContent = 'C√ìDIGO INCORRETO. Tente novamente!';
        answerInput.value = '';
      }
    });

    // Permitir enviar com a tecla Enter
    answerInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') submitBtn.click();
    });
  </script>

  <!-- matrix rain background -->
  <script>
    const matrix = document.getElementById('matrix');
    const ctx = matrix.getContext('2d');
    function resize(){
      matrix.width = window.innerWidth;
      matrix.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    const fontSize = 16;
    let columns = Math.floor(matrix.width / fontSize);
    let drops = Array(columns).fill(1);

    function draw(){
      ctx.fillStyle = 'rgba(0,0,0,0.05)';
      ctx.fillRect(0,0,matrix.width,matrix.height);
      ctx.fillStyle = '#0f0';
      ctx.font = fontSize + 'px monospace';
      for(let i=0;i<drops.length;i++){
        const text = letters.charAt(Math.floor(Math.random()*letters.length));
        ctx.fillText(text, i*fontSize, drops[i]*fontSize);
        if(drops[i]*fontSize > matrix.height && Math.random() > 0.975) drops[i]=0;
        drops[i]++;
      }
      requestAnimationFrame(draw);
    }
    draw();
  </script>
</body>
</html>